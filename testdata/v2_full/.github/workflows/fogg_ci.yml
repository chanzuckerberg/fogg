# Auto-generated by fogg. Do not edit
# Make improvements in fogg, so that everyone can benefit.

on: push

jobs:
  terraform_0:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python 3.x
        uses: actions/setup-python@v1
        with:
          python-version: '3.6'
      - run: python3 -m venv venv
      - run: . venv/bin/activate
      - run: pip install awscli --upgrade --user
      - run: aws --version
      - run: FOGG_VERSION="vundefined+undefined+dirty" make setup
      - run: |
          .fogg/bin/fogg apply
          if [ "$(git status --porcelain)" != "" ]; then
            echo "git tree is dirty after running fogg apply"
            echo "ensure you run fogg apply on your branch"
            git status
            exit 1
          fi
      - run: aws configure set aws_access_key_id     $IDACCT_AWS_ACCESS_KEY_ID     --profile _idacct
      - run: aws configure set aws_secret_access_key $IDACCT_AWS_SECRET_ACCESS_KEY --profile _idacct
      - run: aws --profile _idacct sts get-caller-identity
      - run: aws configure set profile.comp1.role_arn arn:aws:iam::1234:role/testo-role
      - run: aws configure set profile.comp1.source_profile _idacct
      - run: aws --profile comp1 sts get-caller-identity
      - run: aws configure set profile.profile.role_arn arn:aws:iam::456:role/testo-role
      - run: aws configure set profile.profile.source_profile _idacct
      - run: aws --profile profile sts get-caller-identity
      - run: |
          cd terraform/accounts/bar
          make  check
      - run: |
          cd terraform/accounts/foo
          make  check
      - run: |
          cd terraform/global
          make  check
      - run: |
          cd terraform/modules/my_module
          make  check
      - run: |
          cd terraform/envs/staging/comp1
          make  check
      - run: |
          cd terraform/envs/staging/comp2
          make  check
      - run: |
          cd terraform/envs/staging/comp_helm_template
          make  check
      - run: |
          cd terraform/envs/staging/vpc
          make  check

package cmd

import (
	"os"

	"github.com/spf13/cobra"
)

type options struct {
	serverURL    string
	clientID     string
	clientSecret string
}

var opts options

var rootCmd = &cobra.Command{
	Use:   "grid-sync",
	Short: "Syncs Fogg markers with the Grid API",
	Long: `grid-sync is a tool to synchronize local marker files (.grid-state.yaml)
generated by Fogg with the remote Grid API.`,
}

func Execute() {
	if err := rootCmd.Execute(); err != nil {
		os.Exit(1)
	}
}

func envDefault(key, fallback string) string {
	if val := os.Getenv(key); val != "" {
		return val
	}
	return fallback
}

func init() {
	rootCmd.PersistentFlags().StringVar(&opts.serverURL, "server", envDefault("GRID_API_URL", ""), "Grid API base URL (or use GRID_API_URL)")
	rootCmd.PersistentFlags().StringVar(&opts.clientID, "client-id", envDefault("GRID_CLIENT_ID", ""), "Grid service account client ID (or use GRID_CLIENT_ID)")
	rootCmd.PersistentFlags().StringVar(&opts.clientSecret, "client-secret", envDefault("GRID_CLIENT_SECRET", ""), "Grid service account client secret (or use GRID_CLIENT_SECRET)")
}

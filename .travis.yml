language: go
go:
  - "1.11"
install:
  - npm install -g snyk
  - make setup

script:
  - make

jobs:
  include:
    - stage: test
      script:
        - make
        - bash <(curl -s https://codecov.io/bash)
    - stage: snyk
      script:
        - snyk monitor --org=czi
        - snyk test

stages:
  - test
  - name: snyk
    if: env(SNYK_TOKEN) IS present

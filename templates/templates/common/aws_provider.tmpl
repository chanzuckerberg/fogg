{{ define "aws_provider" }}
provider "aws" {
  {{ if .Alias }}alias = "{{ .Alias }}"{{ end }}
  region = "{{ .Region }}"
  {{ if .Profile }} profile = "{{ .Profile }}"{{ end }}
  {{ if .RoleArn }}
  assume_role {
    role_arn     = "{{ .RoleArn }}"
  }
  {{ end }}
  allowed_account_ids = ["{{ .AccountID }}"]
  {{- if and .IgnoreTags (and .IgnoreTags.Enabled (deRefBool .IgnoreTags.Enabled)) }}
  ignore_tags {
    {{- if and .IgnoreTags.Keys (not (eq (len .IgnoreTags.Keys) 0)) }}
    keys= {{ toHCLExpression .IgnoreTags.Keys }}
    {{- end }}
    {{- if and .IgnoreTags.KeyPrefixes (not (eq (len .IgnoreTags.KeyPrefixes) 0)) }}
    key_prefixes = {{ toHCLExpression .IgnoreTags.KeyPrefixes }}
    {{- end }}
  }
  {{- end }}
  {{- if and .DefaultTags (and .DefaultTags.Enabled (deRefBool .DefaultTags.Enabled)) }}
  default_tags {
    {{- if .DefaultTags.Tags }}
    tags = merge(var.tags, {{ toHCLExpression .DefaultTags.Tags }})
    {{- else }}
    tags = var.tags
    {{- end }}
  }
  {{- end }}
}
{{ end }}
